<!DOCTYPE html>
<html>
<head>
    <title>nikoniko</title>

    <script type="text/javascript" src="/apps/2.0rc1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",getAppId:function(){return"14154311144"},getCurrentUser:function(){return this.getContext().getUser().ObjectID},_encodeKey:function(date,user){return date+"/"+user},items:[{xtype:"container",itemId:"outercontainer",layout:{type:"vbox"},items:[{xtype:"container",itemId:"labelcontainer",layout:{type:"hbox",align:"stretch"}},{xtype:"container",itemId:"buttoncontainer",layout:{type:"hbox",align:"stretch"}}]}],launch:function(){this._doButtonLayout()},_doButtonLayout:function(){var today=Ext.Date.format(new Date,"Y-m-d"),button1=Ext.create("Rally.ui.Button",{text:"Good",listeners:{click:function(button,event){this.saveMood(today,this.getCurrentUser(),3)},scope:this}}),button2=Ext.create("Rally.ui.Button",{text:"Neutral",listeners:{click:function(button,event){this.saveMood(today,this.getCurrentUser(),2)},scope:this}}),button3=Ext.create("Rally.ui.Button",{text:"Bad",listeners:{click:function(button,event){this.saveMood(today,this.getCurrentUser(),1)},scope:this}}),labelToday=Ext.create("Ext.Component",{html:today});this.down("#labelcontainer").add(labelToday),this.down("#buttoncontainer").add(button1),this.down("#buttoncontainer").add(button2),this.down("#buttoncontainer").add(button3)},getPreferencesByDateAndUser:function(date,user){console.log("Getting mood....."),Rally.data.PreferenceManager.load({additionalFilters:[{property:"Name",operator:"contains",value:this._encodeKey(date,user)}],workspace:this.getContext().getWorkspaceRef(),scope:this,success:function(preferences){console.log("Got: ",preferences)}})},saveMood:function(date,user,mood){console.log("Saving mood.....");var key=this._encodeKey(date,user),value=mood,mysettings={};mysettings[key]=value,Rally.data.PreferenceManager.update({workspace:this.getContext().getWorkspaceRef(),scope:this,settings:mysettings,success:function(updatedRecords,noUpdatedRecords){console.log("Mood stored for "+user+" on "+date+": "+mood),console.log(updatedRecords),console.log(noUpdatedRecords)}})}});

            Rally.launchApp('CustomApp', {
                name:"nikoniko",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .app {
     /* Add app styles here */
}

    </style>
</head>
<body></body>
</html>
